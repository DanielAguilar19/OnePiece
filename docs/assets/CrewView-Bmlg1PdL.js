import{u as k,s as E}from"./CharactersInterceptor-D0iKAgMO.js";import{a as _,d as C,r as i,o as N,b as A,c as n,e as c,f as o,t as u,F as D,g as O,l as T,h as B,i as v,j as w,u as V,_ as L,k as $}from"./index-B6NKHu9Y.js";const M={async GetCrews(){try{return(await _.get("https://api.api-onepiece.com/v2/crews/en")).data}catch(l){return console.error("Error fetching crews:",l),[]}},async GetCrewById(l){try{return(await _.get(`https://api.api-onepiece.com/v2/crews/en/${l}`)).data}catch(t){return console.error(`Error fetching crew with ID ${l}:`,t),null}}},F={key:0,class:"loading-container"},G={key:1,class:"error-container"},J={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},R={class:"crew-header"},P={class:"crew-label"},j={class:"m-0"},q={class:"m-0"},z={key:3,class:"no-data"},g="one-piece-crews",y=6,K=C({__name:"CrewsComponent",setup(l){const t=i([]),r=i([]),b=i([]),f=i(new Set),d=i(!0),p=i(null);N(async()=>{await m()});async function m(){d.value=!0,p.value=null;try{const e=sessionStorage.getItem(g);if(e){const a=JSON.parse(e);if(Array.isArray(a)&&a.length>0){t.value=a,console.log("Crews loaded from sessionStorage:",t.value.length),h(),d.value=!1;return}}console.log("Fetching crews from API...");const s=await M.GetCrews();Array.isArray(s)&&s.length>0?(t.value=s,sessionStorage.setItem(g,JSON.stringify(t.value)),console.log("Crews fetched and saved:",t.value.length)):(console.warn("La respuesta de API no es válida, usando datos de fallback"),sessionStorage.setItem(g,JSON.stringify(t.value))),h()}catch(e){console.error("Error al cargar datos:",e),p.value="Error al cargar las tripulaciones. Por favor, intenta de nuevo.",sessionStorage.setItem(g,JSON.stringify(t.value)),h()}finally{d.value=!1}}function h(){r.value=t.value.slice(0,y),r.value.forEach(e=>{f.value.add(e.id)})}function S(){sessionStorage.removeItem(g),m()}A(()=>{t.value.length>y&&I()});function I(){const e=document.createElement("div");e.style.width="100%",e.style.height="20px",e.id="load-more-trigger",setTimeout(()=>{const s=document.querySelector(".grid");s&&(s.appendChild(e),k(i(e),()=>{x()},{threshold:.1}))},500)}function x(){if(r.value.length>=t.value.length)return;const e=t.value.filter(s=>!f.value.has(s.id)).slice(0,6);e.length!==0&&(r.value=[...r.value,...e],e.forEach(s=>{f.value.add(s.id)}),console.log(`Loaded ${e.length} more crews. Total: ${r.value.length}/${t.value.length}`))}return(e,s)=>(n(),c("div",null,[d.value?(n(),c("div",F,s[0]||(s[0]=[o("p",null,"Cargando tripulaciones...",-1)]))):p.value?(n(),c("div",G,[o("p",null,u(p.value),1),o("button",{onClick:S,class:"retry-button"},"Reintentar")])):(n(),c("div",J,[(n(!0),c(D,null,O(r.value,a=>(n(),B(V(E),{class:"card",key:a.id,style:{width:"25rem",overflow:"hidden"},ref_for:!0,ref_key:"crewCardRefs",ref:b},{header:v(()=>[o("div",R,[o("span",P,u(a.name),1)])]),title:v(()=>[w(u(a.name),1)]),subtitle:v(()=>[w(u(a.status||"Sin Descripción Disponible"),1)]),content:v(()=>[o("p",j,"Members: "+u(a.number||"Sin nombre."),1),o("p",q,"Total bounty: "+u(a.total_prime||"Sin Descripción Disponible."),1)]),footer:v(()=>s[1]||(s[1]=[o("div",{class:"flex gap-4 mt-1"},[o("button",{class:"detail-button"},"Ver Detalles")],-1)])),_:2},1024))),128))])),!d.value&&!p.value&&r.value.length===0?(n(),c("div",z," No hay tripulaciones disponibles. ")):T("",!0)]))}}),U=L(K,[["__scopeId","data-v-9c300d9c"]]),Q=C({__name:"CrewView",setup(l){return(t,r)=>(n(),c("div",null,[r[0]||(r[0]=o("h1",{class:"mx-5 text-3xl"},"Lista de Tripulaciones",-1)),$(U)]))}});export{Q as default};
